name: CI/CD Deployment to EC2

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Set up SSH key
      run: |
        echo "${{ secrets.PRIVATE_KEY }}" > newkey.pem
        chmod 600 newkey.pem

    - name: Deploy to EC2
      run: |
        ssh -i newkey.pem -o StrictHostKeyChecking=no ubuntu@44.220.156.184 << 'EOF'
          echo "ðŸ”„ Pulling latest changes"
          cd ~/New-project
          git pull origin main

          echo "ðŸ” Restarting Docker containers"
          sudo docker-compose down
          sudo docker-compose up -d --build

          echo "âœ… Deployment finished"
        EOF
