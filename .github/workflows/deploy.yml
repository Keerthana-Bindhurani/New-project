name: Deploy Java Application

on:
  push:
    branches:
      - main  # Trigger this workflow on changes to the 'main' branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the code
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: Set up SSH key
      - name: Set up SSH key
        run: |
          echo "${{ secrets.PRIVATE_KEY }}" > newkey.pem
          sed -i 's/\r//' newkey.pem  # Remove any carriage return issues
          chmod 600 newkey.pem

      # Step 3: Deploy to EC2
      - name: Deploy to EC2
        run: |
          ssh -o StrictHostKeyChecking=no -i newkey.pem ubuntu@44.220.156.184 << 'EOF'
            cd ~/New-project
            git pull origin main  # Pull the latest changes from GitHub
            sudo docker-compose down  # Stop the running containers
            sudo docker-compose up -d --build  # Build and start the containers in detached mode
          EOF
